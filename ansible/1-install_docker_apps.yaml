---
- hosts: all
  tasks:

    - name: Deploy Portainer
      community.docker.docker_container:
        name: portainer
        image: portainer/portainer-ce:latest
        ports:
          - "9000:9000"
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock
          - portainer_data:/data
        restart_policy: always

    - name: Deploy Plex
      community.docker.docker_container:
        name: plex
        image: lscr.io/linuxserver/plex:latest
        volumes:
          - /path/to/library:/config
          - /path/to/tvseries:/tv
          - /path/to/movies:/movies
        # ports:
        #   - "32400:32400"
        restart_policy: unless-stopped
        network_mode: host
        env:
          VERSION: "docker"
          PUID: "1000"
          PGID: "1000"

    - name: Deploy Pi-Hole
      community.docker.docker_container:
        name: pihole
        image: pihole/pihole:latest
        volumes:
          - './etc-pihole:/etc/pihole'
          - './etc-dnsmasq.d:/etc/dnsmasq.d'
        ports:
          - "54:54/tcp"
          - "54:54/udp"
          - "5335:80/tcp"
        restart_policy: unless-stopped
        env:
          TZ: "Europe/London"
          WEBPASSWORD: 'password123'